# Internationalization (i18n) Guide

This document explains how multilingual support is implemented in this app and how to add or use languages in other apps following the same structure.

## Stack Overview
- Runtime: Next.js App Router
- i18n: next-intl (middleware + server/client APIs)
- Messages: JSON per locale under `messages/`

## Directory & File Structure
```
app/
  [locale]/
    layout.tsx             # Locale-aware root layout (wraps provider)
    page.tsx               # Home page (server translations)
    inbox/page.tsx         # Inbox page (client translations)
    5-minutes-temporary-email/
      page.tsx             # Feature page (client translations)
      inbox/page.tsx       # Feature inbox (client translations)

components/
  header.tsx               # Uses useLocale/useTranslations
  footer.tsx               # Language dropdown, locale-aware links
  language-switcher.tsx    # Floating switcher (optional)
  email-detail-modal.tsx   # Client component, localized text

lib/
  i18n-config.ts           # Single source of truth for languages and messages

i18n/
  request.ts               # next-intl request config (SSR message loading)

messages/
  en.json
  es.json

middleware.ts              # next-intl middleware (locale prefixing)
next.config.mjs            # next-intl plugin
```

## Single Source of Truth
Edit only `lib/i18n-config.ts` to manage languages.
- `supportedLocales`: list of enabled locales
- `defaultLocale`: fallback locale
- `messagesMap`: imports of JSON dictionaries
- Helpers: `isValidLocale`, `getLocaleMessages`

## Middleware
`middleware.ts` enables locale routing and detection:
```ts
import createMiddleware from 'next-intl/middleware'
import {locales, defaultLocale} from './lib/i18n-config'

export default createMiddleware({
  locales: Array.from(locales),
  defaultLocale
})

export const config = {
  matcher: ['/((?!api|_next|_vercel|.*\\..*).*)']
}
```

## Next Config
`next.config.mjs` enables next-intl plugin:
```ts
import createNextIntlPlugin from 'next-intl/plugin'
const withNextIntl = createNextIntlPlugin()
export default withNextIntl({ /* existing Next config */ })
```

## Request Config (SSR messages)
`i18n/request.ts` validates locale and loads messages:
```ts
import {getRequestConfig} from 'next-intl/server'
import {getLocaleMessages, isValidLocale, defaultLocale} from '../lib/i18n-config'

export default getRequestConfig(async ({locale}) => {
  const selectedLocale = isValidLocale(locale || '') ? (locale as string) : defaultLocale
  const messages = getLocaleMessages(selectedLocale)
  return {locale: selectedLocale, messages}
})
```

## Provider Setup
Wrap the app with `NextIntlClientProvider` in `app/[locale]/layout.tsx` and pass `locale` + `messages`:
```tsx
import {NextIntlClientProvider} from 'next-intl'
import {messagesMap} from '../../messages'
import type {AppLocale} from '../../i18n'

export default async function LocaleLayout({children, params}:{children: React.ReactNode; params: Promise<{locale: string}>}) {
  const {locale} = await params
  const safeLocale = (['en','es'].includes(locale) ? locale : 'en') as AppLocale
  const messages = messagesMap[safeLocale]

  return (
    <html lang={safeLocale} suppressHydrationWarning>
      <body>
        <NextIntlClientProvider locale={safeLocale} messages={messages}>
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  )
}
```

## Using Translations
- Server components (SSR):
```tsx
import {getTranslations} from 'next-intl/server'
export default async function Page({params}:{params: Promise<{locale:string}>}) {
  const {locale} = await params
  const t = await getTranslations({locale})
  return <h1>{t('home.title')}</h1>
}
```

- Client components:
```tsx
'use client'
import {useTranslations, useLocale} from 'next-intl'
export function Component() {
  const t = useTranslations()
  const locale = useLocale()
  return <div>{t('footer.language')} ({locale})</div>
}
```

## Locale-aware Links
Prefer one of these patterns so links stay under the current locale:
- In server components: `href={`inbox`}` (relative to `/[locale]` segment)
- In client components: `href={`/${locale}/inbox`}` using `useLocale()`

Examples:
```tsx
// Server component CTA
<Link href="inbox">...</Link>

// Client component
const locale = useLocale()
<Link href={`/${locale}/inbox`}>...</Link>
```

## Adding a New Language
1. Add locale code to `supportedLocales` in `lib/i18n-config.ts`.
2. Create `messages/<locale>.json`.
3. Import the JSON and extend `messagesMap` in `lib/i18n-config.ts`.
4. (Optional) Add display name and flag in `languageNames` / `languageFlags`.
5. Done â€” middleware, provider, and pages will load it automatically.

## Date/Number Formatting
- Use `useLocale()` for client formatting, e.g. `date.toLocaleString(locale)`.
- Server: use the current `locale` from route params.

## Troubleshooting
- If a page shows the wrong language, ensure it resolves locale correctly:
  - Server: `getTranslations({locale: params.locale})`
  - Provider: pass `locale` and `messages` to `NextIntlClientProvider`
  - Links: avoid absolute non-locale paths like `/inbox`; use relative or `/${locale}/...`
- If middleware logs show `incoming: undefined`, a request may be missing the locale prefix. Navigate via `/${locale}/...`.

## Message Organization Tips
- Group by feature: `home`, `inbox`, `emailGenerator`, `fiveMinEmail`, `emailModal`, `footer`, etc.
- Keep keys semantically named and reused across pages where possible.

## Reuse in Other Apps
Copy these minimal files/ideas:
- `lib/i18n-config.ts`
- `i18n/request.ts`
- `middleware.ts` (with your locales)
- Wrap `app/[locale]/layout.tsx` with `NextIntlClientProvider`
- Create `messages/<locale>.json` per locale
- Use `getTranslations` (server) and `useTranslations` (client)
- Make links locale-aware per patterns above

---
With this setup, adding languages or reusing i18n across apps is a matter of copying the structure, wiring the provider, and pointing links and translations to the right keys.
